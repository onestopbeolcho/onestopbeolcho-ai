<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>서비스 신청 - 원스톱 벌초</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="manifest" href="/manifest.json?v=1">
  <meta name="theme-color" content="#1E88E5">

  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ef6b942fdad36e982c84eb0061d1d2ed&libraries=services"></script>
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <link rel="stylesheet" href="/styles/common.css?v=1">

  <style>
    body { padding-top: 60px; }
    .step-container { display: none; }
    .step-container.active { display: block; }
    .progress-container { margin-bottom: 20px; }
    .progress-bar { background-color: #6D4AFF; }
    .progress-text { color: #1E88E5; font-weight: 500; }
    .progress-arrow { position: absolute; top: -35px; left: 50%; transform: translateX(-50%); font-size: 1.2rem; color: #1E88E5; animation: bounce 1s infinite; }
    @keyframes bounce { 0%, 100% { transform: translateX(-50%) translateY(0); } 50% { transform: translateX(-50%) translateY(-10px); } }
    #nv-map { width: 100%; height: 500px; border-radius: 8px; margin-top: 10px; }
    .service-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; }
    .service-card { background-color: #fff; border: 1px solid #dee2e6; border-radius: 10px; padding: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; position: relative; }
    .service-card:hover { background-color: #1E88E5; color: white; border-color: #1E88E5; }
    .service-card input[type="radio"] { display: none; }
    .service-card label { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100%; margin: 0; cursor: pointer; padding: 15px; }
    .service-card input[type="radio"]:checked + label { background-color: #1E88E5; color: white; border-color: #1E88E5; }
    .service-card input[type="radio"]:checked + label .check-icon { display: block; }
    .check-icon { display: none; position: absolute; top: 5px; right: 5px; color: #fff; font-size: 1rem; }
    .service-text { display: block; width: 100%; }
    .form-label { display: flex; align-items: center; gap: 0.5rem; }
    .form-label i { color: #6D4AFF; }
    .form-control { border-radius: 10px; padding: 0.75rem; font-size: 1rem; border: 1px solid #1E88E5; }
    .form-control:focus { border-color: #6D4AFF; box-shadow: 0 0 5px rgba(109, 74, 255, 0.3); }
    .btn-primary, .btn-secondary { padding: 0.5rem 1.5rem; font-size: 1rem; }
    #address-search-btn { color: #1E88E5; border-color: #1E88E5; border-radius: 20px; padding: 0.5rem 1rem; font-size: 0.9rem; }
    #address-search-btn:hover { background-color: #1E88E5; color: white; border-color: #1E88E5; }
    .btn-loading::after { content: ' '; display: inline-block; width: 16px; height: 16px; margin-left: 8px; border: 2px solid #fff; border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @media (min-width: 768px) { .service-cards { grid-template-columns: repeat(3, 1fr); } #nv-map { height: 400px; } }
    @media (max-width: 768px) { .service-cards { grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; } .service-card { padding: 10px; } .service-card label { padding: 10px; } .check-icon { font-size: 0.8rem; } .form-control { padding: 0.6rem; font-size: 0.9rem; } .btn-primary, .btn-secondary { padding: 0.4rem 1.2rem; font-size: 0.9rem; } #address-search-btn { padding: 0.4rem 0.8rem; font-size: 0.8rem; } }
  </style>
</head>
<body>
  <div id="navbar-placeholder" style="position: fixed; top: 0; left: 0; right: 0; z-index: 1000;"></div>

  <div class="container">
    <h2 class="text-center mb-4 fw-bold">서비스 신청</h2>
    <div class="progress-container">
      <div class="progress">
        <div class="progress-bar bg-primary" id="progressBar" style="width: 0%"></div>
      </div>
      <div class="progress-text text-center" id="progressText"></div>
      <div class="progress-arrow">▼</div>
    </div>

    <div class="request-container">
      <form id="service-form">
        <div class="step-container active" id="step1">
          <div class="form-group">
            <label class="form-label"><i class="fas fa-cut"></i> 서비스 유형 <span class="text-danger">*</span></label>
            <div class="service-cards">
              <div class="service-card">
                <input type="radio" id="service-type1" name="service-type" value="벌초" required>
                <label for="service-type1">
                  <span class="service-text">벌초 서비스</span>
                  <i class="fas fa-check check-icon"></i>
                </label>
              </div>
              <div class="service-card">
                <input type="radio" id="service-type2" name="service-type" value="예초">
                <label for="service-type2">
                  <span class="service-text">예초 서비스</span>
                  <i class="fas fa-check check-icon"></i>
                </label>
              </div>
              <div class="service-card">
                <input type="radio" id="service-type3" name="service-type" value="태양광 예초 관리">
                <label for="service-type3">
                  <span class="service-text">태양광 예초 관리</span>
                  <i class="fas fa-check check-icon"></i>
                </label>
              </div>
              <div class="service-card">
                <input type="radio" id="service-type4" name="service-type" value="가지치기">
                <label for="service-type4">
                  <span class="service-text">가지치기</span>
                  <i class="fas fa-check check-icon"></i>
                </label>
              </div>
              <div class="service-card">
                <input type="radio" id="service-type5" name="service-type" value="제초제 살포">
                <label for="service-type5">
                  <span class="service-text">제초제 살포</span>
                  <i class="fas fa-check check-icon"></i>
                </label>
              </div>
              <div class="service-card">
                <input type="radio" id="service-type6" name="service-type" value="나무 제거(벌목)">
                <label for="service-type6">
                  <span class="service-text">나무 제거(벌목)</span>
                  <i class="fas fa-check check-icon"></i>
                </label>
              </div>
              <div class="service-card">
                <input type="radio" id="service-type7" name="service-type" value="기타">
                <label for="service-type7">
                  <span class="service-text">기타</span>
                  <i class="fas fa-check check-icon"></i>
                </label>
              </div>
            </div>
            <small class="form-text text-muted">원하는 서비스를 선택하세요: 벌초(묘지 관리), 예초(일반 풀 제거), 태양광 예초 관리(패널 주변), 가지치기(나뭇가지 정리), 제초제 살포(잡초 제거), 나무 제거(벌목), 기타(직접 입력). <br>기타를 선택한 경우 아래 입력창에 구체적인 서비스 내용을 작성해 주세요.</small>
            <input type="text" id="custom-service" class="form-control mt-2" placeholder="기타 서비스 입력" style="display: none;">
          </div>
          <div class="d-flex justify-content-between mt-3">
            <button type="button" class="btn btn-secondary rounded-pill" disabled>이전</button>
            <button type="button" class="btn btn-primary rounded-pill" id="next-step1">다음</button>
          </div>
        </div>

        <div class="step-container" id="step2">
          <div class="form-group">
            <label for="customer-name" class="form-label"><i class="fas fa-user"></i> 이름 <span class="text-danger">*</span></label>
            <input type="text" id="customer-name" class="form-control" placeholder="예: 홍길동" required autocomplete="off">
            <small class="form-text text-muted">개인 또는 기업명을 입력하세요. 신청 확인 시 사용됩니다. <br>예: 홍길동, (주)메타아이엠</small>
          </div>
          <div class="d-flex justify-content-between mt-3">
            <button type="button" class="btn btn-secondary rounded-pill" id="prev-step2">이전</button>
            <button type="button" class="btn btn-primary rounded-pill" id="next-step2">다음</button>
          </div>
        </div>

        <div class="step-container" id="step3">
          <div class="form-group">
            <label for="customer-phone" class="form-label"><i class="fas fa-phone"></i> 연락처 <span class="text-danger">*</span></label>
            <input type="tel" id="customer-phone" class="form-control" placeholder="예: 01012345678" maxlength="13" required autocomplete="off">
            <small class="form-text text-muted">작업자와 연락 시 사용할 번호를 입력하세요. <br>형식: 01012345678 (하이픈 없이 입력)</small>
          </div>
          <div class="d-flex justify-content-between mt-3">
            <button type="button" class="btn btn-secondary rounded-pill" id="prev-step3">이전</button>
            <button type="button" class="btn btn-primary rounded-pill" id="next-step3">다음</button>
          </div>
        </div>

        <div class="step-container" id="step4">
          <div class="form-group">
            <label for="customer-password" class="form-label"><i class="fas fa-lock"></i> 비밀번호</label>
            <input type="password" id="customer-password" class="form-control" placeholder="신청 조회용" autocomplete="new-password">
            <small class="form-text text-muted">신청 내역 조회 시 사용할 비밀번호입니다. <br>4~8자리로 설정해 주세요. 나중에 비회원 재신청 시 필요합니다. <br><strong>회원가입 하시면 비밀번호 입력을 안하셔도 됩니다.</strong></small>
          </div>
          <div class="d-flex justify-content-between mt-3">
            <button type="button" class="btn btn-secondary rounded-pill" id="prev-step4">이전</button>
            <button type="button" class="btn btn-primary rounded-pill" id="next-step4">다음</button>
          </div>
        </div>

        <div class="step-container" id="step5">
          <div class="form-group">
            <label class="form-label"><i class="fas fa-map-marker-alt"></i> 위치 정보 <span class="text-danger">*</span></label>
            <button type="button" id="address-search-btn" class="btn btn-outline-primary btn-sm mb-2">주소 검색</button>
            <input type="text" id="address" class="form-control" placeholder="주소를 검색하세요" readonly required autocomplete="off">
            <div id="nv-map"></div>
            <small class="form-text text-muted">주소를 검색한 후 지도에서 정확한 위치를 선택하세요. <br>위성사진 모드에서 핀을 이동하여 작업 위치를 지정할 수 있습니다.</small>
          </div>
          <div class="d-flex justify-content-between mt-3">
            <button type="button" class="btn btn-secondary rounded-pill" id="prev-step5">이전</button>
            <button type="button" class="btn btn-primary rounded-pill" id="next-step5">다음</button>
          </div>
        </div>

        <div class="step-container" id="step6">
          <div class="form-group" id="service-details">
            <label class="form-label"><i class="fas fa-info-circle"></i> 세부 사항</label>
            <small class="form-text text-muted">선택한 서비스 유형에 따라 필요한 세부 정보를 입력하세요. <br>예: 벌초의 경우 묘지 종류와 분묘 수를 입력해야 합니다.</small>
          </div>
          <div class="d-flex justify-content-between mt-3">
            <button type="button" class="btn btn-secondary rounded-pill" id="prev-step6">이전</button>
            <button type="button" class="btn btn-primary rounded-pill" id="next-step6">다음</button>
          </div>
        </div>

        <div class="step-container" id="step7">
          <div class="form-group">
            <label for="work-date" class="form-label"><i class="fas fa-calendar-alt"></i> 희망 작업 날짜 <span class="text-danger">*</span></label>
            <input type="date" id="work-date" class="form-control" required>
            <small class="form-text text-muted">작업을 원하는 날짜를 선택하세요. <br>작업 가능 여부는 작업자와 상의 후 확정됩니다.</small>
          </div>
          <div class="d-flex justify-content-between mt-3">
            <button type="button" class="btn btn-secondary rounded-pill" id="prev-step7">이전</button>
            <button type="button" class="btn btn-primary rounded-pill" id="next-step7">다음</button>
          </div>
        </div>

        <div class="step-container" id="step8">
          <div class="form-group">
            <label for="additional-notes" class="form-label"><i class="fas fa-comment"></i> 추가 요청사항</label>
            <textarea id="additional-notes" class="form-control" rows="4" placeholder="작업 시 참고할 사항이나 특별한 요청사항이 있다면 입력해 주세요."></textarea>
            <small class="form-text text-muted">작업 시 참고할 사항이나 특별한 요청사항이 있다면 입력해 주세요. <br>예: 특정 시간대 작업 희망, 특별한 주의사항 등</small>
          </div>
          <div class="d-flex justify-content-between mt-3">
            <button type="button" class="btn btn-secondary rounded-pill" id="prev-step8">이전</button>
            <button type="button" class="btn btn-primary rounded-pill" id="next-step8">다음</button>
          </div>
        </div>

        <div class="step-container" id="step9">
          <div class="form-group">
            <label class="form-label"><i class="fas fa-check-circle"></i> 최종 확인</label>
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">신청 내용 확인</h5>
                <div id="summary-content"></div>
              </div>
            </div>
            <div class="form-check mt-3">
              <input class="form-check-input" type="checkbox" id="terms-agreement" required>
              <label class="form-check-label" for="terms-agreement">
                <a href="/terms.html" target="_blank">이용약관</a>과 <a href="/privacy.html" target="_blank">개인정보처리방침</a>에 동의합니다.
              </label>
            </div>
          </div>
          <div class="d-flex justify-content-between mt-3">
            <button type="button" class="btn btn-secondary rounded-pill" id="prev-step9">이전</button>
            <button type="submit" class="btn btn-primary rounded-pill" id="submit-request">신청하기</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <footer id="footer-container"></footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script src="scripts/navbar.js"></script>
  <script type="module" src="scripts/firebase-config.js"></script>
  <script type="module" src="scripts/auth.js"></script>
  <script type="module" src="scripts/request.js"></script>
</body>
</html>